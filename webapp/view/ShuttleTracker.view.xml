<mvc:View
    controllerName="esdm.realtime.tracking.controller.ShuttleTracker"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:html="http://www.w3.org/1999/xhtml"
    xmlns:l="sap.ui.layout">

    <Page
        showHeader="true"
        backgroundDesign="Solid"
        class="sapUiContentPadding">
        
        <customHeader>
             <Bar class="profileHeader"> <!-- Reusing blue profile header for main header match -->
                <contentLeft>
                    <Title text="{i18n>appTitle}" level="H2" class="profileTitle sapUiSmallMarginBegin"/>
                </contentLeft>
                <contentRight>
                    <Avatar src="sap-icon://customer" displaySize="XS" press="onProfilePress" active="true" class="sapUiSmallMarginEnd pointerCursor"/>
                </contentRight>
             </Bar>
        </customHeader>

        <content>
            <VBox class="sapUiSmallMargin">
                <Title text="{i18n>busName}" level="H2" class="sapUiSmallMarginBottom"/>
                <Text text="{i18n>selectStop}" class="sapUiSmallMarginBottom secondaryText"/>

                <!-- Bus Info Cards -->
                <HBox alignItems="Center" justifyContent="SpaceBetween" class="sapUiSmallMarginBottom">
                    <VBox class="infoCard">
                        <Label text="DRIVER" design="Bold" class="infoLabel"/>
                        <Text text="{/driverName}" class="infoValue"/>
                    </VBox>
                    <VBox class="infoCard">
                         <Label text="PLAT NO" design="Bold" class="infoLabel"/>
                         <Text text="{/plateNumber}" class="infoValue"/>
                    </VBox>
                </HBox>

                <!-- Bus Occupancy Card -->
                <VBox class="infoCard" width="100%">
                    <HBox justifyContent="SpaceBetween" alignItems="Center">
                        <Label text="LIVE PASSENGER LOAD" design="Bold" class="infoLabel"/>
                        <Label text="{/occupancyStatus}" design="Bold" class="infoLabel" state="{= ${/occupancyLevel} > 80 ? 'Error' : (${/occupancyLevel} > 50 ? 'Warning' : 'Success') }"/>
                    </HBox>
                    <ProgressIndicator 
                        percentValue="{/occupancyLevel}" 
                        displayValue="{/occupancyLevel}%" 
                        state="{= ${/occupancyLevel} > 80 ? 'Error' : (${/occupancyLevel} > 50 ? 'Warning' : 'Success') }"
                        height="1.5rem"
                        class="sapUiSmallMarginTop"/>
                </VBox>

                <!-- Timeline Container -->
                <VBox class="timelineContainer">
                    <!-- The vertical line -->
                    <VBox class="timelineLine" />
                    
                    <!-- The moving bus icon -->
                    <!-- We bind the 'top' property in controller to move it -->
                    <VBox id="busIcon" class="shuttleIconWrapper" alignItems="Center" justifyContent="Center">
                         <core:Icon src="sap-icon://public-transport" class="shuttleIcon" />
                    </VBox>

                    <List items="{/stops}" showSeparators="None" backgroundDesign="Transparent" itemPress="onStopPress">
                        <CustomListItem type="Active" press="onStopPress" class="transparentItem">
                            <HBox class="stopItem" alignItems="Center">
                                <!-- Stop Markers -->
                                <!-- Standard Marker -->
                                <VBox class="stopMarker" visible="{= !${selected} }" />
                                <!-- 'You' Marker -->
                                <VBox class="youMarker" visible="{= ${selected} }" alignItems="Center" justifyContent="Center">
                                    <Text text="You" class="youText" />
                                </VBox>
                                
                                <!-- Stop Name -->
                                <VBox class="stopContent sapUiSmallMarginBegin" width="100%">
                                    <Text text="{name}" class="stopName {= ${selected} ? 'selectedStopName' : '' }" />
                                </VBox>
                                
                                <!-- Selected Label -->
                                <Label text="SELECTED" visible="{selected}" class="selectedLabel" />
                            </HBox>
                        </CustomListItem>
                    </List>
                </VBox>

            </VBox>
        </content>
    </Page>
</mvc:View>
